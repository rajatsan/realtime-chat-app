(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t){},136:function(e,t,a){},137:function(e,t,a){},138:function(e,t,a){},140:function(e,t,a){},141:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(9),o=a.n(r),i=a(18),c=a(19),u=a(21),l=a(20),d=a(22),m=a(179),h=a(34),p=a(59),v=a.n(p),g=a(78),f=a(31),E=a(180),w=a(177),b=a(182),S=a(23),k=(a(93),{name:"",username:"",password:"",confPassword:"",signup:!1,userError:"",passwordError:"",confirmError:"",notification:"",nameError:""}),y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).handleInput=function(e){return function(t){a.setState(Object(f.a)({},e,t.target.value)),"username"===e&&a.validateUsername(t.target.value)}},a.validateUsername=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?a.props.users.indexOf(e.toLowerCase())>-1&&a.isNew()?(a.setState({userError:"This username is already taken!"}),!1):a.props.users.indexOf(e.toLowerCase())<0&&!a.isNew()&&t?(a.setState({userError:"Username not found!"}),!1):(a.setState({userError:""}),!0):(a.setState({userError:"Username is required!"}),!1)},a.validatePassword=function(){return a.state.password?a.state.password.length<4?(a.setState({passwordError:"Password should be at least 4 characters long."}),!1):(a.setState({passwordError:""}),!0):(a.setState({passwordError:"Password is required!"}),!1)},a.validateConfirmPassword=function(){return a.state.confPassword?a.state.password!==a.state.confPassword?(a.setState({confirmError:"Passwords do not match!"}),!1):(a.setState({confirmError:""}),!0):(a.setState({confirmError:"Password is required!"}),!1)},a.validateName=function(){return a.state.name?(a.setState({nameError:""}),!0):(a.setState({nameError:"Name is required."}),!1)},a.login=Object(g.a)(v.a.mark(function e(){var t,s,n,r,o,i,c;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,s=t.username,n=t.password,r=a.validateUsername(a.state.username,!0),o=a.validatePassword(),r&&o){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,fetch(S.sessionApi,{method:"put",body:JSON.stringify({username:s,password:n}),headers:S.headers});case 8:return i=e.sent,e.next=11,i.json();case 11:c=e.sent,a.props.onLogin(c.username),a.setState({notification:"Login successful!"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),a.setState({passwordError:"Password is invalid!"});case 19:case"end":return e.stop()}},e,null,[[5,16]])})),a.signup=function(){var e=a.validateUsername(a.state.username,!0),t=a.validatePassword(),s=a.validateConfirmPassword(),n=a.validateName();if(e&&s&&t&&n){var r=a.state,o=r.username,i=r.password;fetch(S.sessionApi,{method:"post",body:JSON.stringify({username:o,password:i}),headers:S.headers}).then(function(e){200==e.status?(a.setState(Object(h.a)({},k,{signup:!1,notification:"Signup successful!"})),a.props.fetchUsers()):a.setState({userError:"This username is already taken!"})})}},a.isNew=function(){return a.state.signup},a.toggle=function(){a.setState(Object(h.a)({},k,{signup:!a.state.signup}),console.log(a.state))},a.state=k,a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.isNew();return n.a.createElement("div",null,n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"title"},"Real-Time Chat Application")),n.a.createElement("div",{className:"form"},t&&n.a.createElement(E.a,{error:""!==this.state.nameError,label:"Name",onChange:this.handleInput("name"),margin:"normal",variant:"outlined",helperText:this.state.nameError,value:this.state.name}),n.a.createElement(E.a,{error:""!==this.state.userError,label:"Username",onChange:this.handleInput("username"),margin:"normal",variant:"outlined",helperText:this.state.userError,value:this.state.username}),n.a.createElement(E.a,{label:"Password",error:""!==this.state.passwordError,type:"password",margin:"normal",variant:"outlined",onChange:this.handleInput("password"),helperText:this.state.passwordError,value:this.state.password}),t&&n.a.createElement(E.a,{label:"Confirm Password",type:"password",margin:"normal",variant:"outlined",onChange:this.handleInput("confPassword"),helperText:this.state.confirmError,error:""!==this.state.confirmError,value:this.state.confPassword}),n.a.createElement(w.a,{variant:"contained",color:"primary",onClick:t?this.signup:this.login,style:{width:"120px",marginTop:"10px",marginBottom:"30px"}},t?"Signup":"Login"),n.a.createElement("div",{className:"footer"},this.isNew()?"Existing":"New"," user?",n.a.createElement(w.a,{color:"secondary",variant:"outlined",style:{marginLeft:"10px"},onClick:this.toggle},t?"Login":"Signup"))),n.a.createElement(b.a,{open:""!==this.state.notification,autoHideDuration:6e3,onClose:function(){return e.setState({notification:""})},ContentProps:{"aria-describedby":"message-id"},message:n.a.createElement("span",{id:"message-id"},this.state.notification)}))}}]),t}(n.a.Component),j=a(49),O=a.n(j),C=(a(136),function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).handleVideo=function(e){a.stream=e;var t=document.querySelector("video");t.srcObject=e,t.onloadedmetadata=function(e){t.play()}},a.videoSuccess=function(e){a.handleVideo(e);var t=document.querySelector("canvas"),s=t.getContext("2d");t.width=250,t.height=200,s.width=t.width,s.height=t.height,setInterval(function(){s.drawImage(a.video,0,0,s.width,s.height),a.props.socket&&a.props.socket.emit("video",t.toDataURL("image/webp"))},5)},a.videoError=function(e){console.log("got error",e)},a.componentDidMount=function(){a.video=document.querySelector("video"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){return a.videoSuccess(e)}):navigator.getUserMedia({video:!0}).then(function(e){return a.videoSuccess(e)})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){this.video&&(this.video.pause(),this.video.src=null),this.stream&&this.stream.getTracks().forEach(function(e){return e.stop()})}},{key:"render",value:function(){return n.a.createElement("div",{className:"videoContainer"},n.a.createElement("video",{autoPlay:!0}),n.a.createElement("div",null,this.props.user),n.a.createElement("canvas",null))}}]),t}(n.a.Component)),N=a(178),U=a(181),x=(a(137),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).keyDown=function(e){13===e.keyCode&&(a.sendMessage(),e.preventDefault())},a.getUser=function(e){return e===a.props.user?"You":e},a.getEmotion=function(e){switch(e){case"positive":return":)";case"negative":return":(";default:return":|"}},a.sendMessage=function(){""!==a.state.text&&(a.socket.emit("send message",{message:a.state.text,username:a.props.user}),a.setState({text:""}))},a.handleTextChange=function(e){a.setState({text:e.target.value})},a.state={messages:[],text:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.socket=O.a.connect("",{query:"username=".concat(this.props.user)}),this.socket.on("send message",function(t){var a=t.message,s=t.username,n=t.emotion;e.setState({messages:e.state.messages.concat([{message:a,username:s,emotion:n}])})})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{style:{paddingBottom:"80px"}},n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{style:{width:"15%"}},"User"),n.a.createElement("th",{style:{width:"70%"}},"Message"),n.a.createElement("th",{style:{width:"15%"}},"Sentiment"))),n.a.createElement("tbody",null,this.state.messages.map(function(t,a){return n.a.createElement("tr",{key:a},n.a.createElement("td",null,e.getUser(t.username)),n.a.createElement("td",null,t.message),n.a.createElement("td",null,e.getEmotion(t.emotion)))}))),n.a.createElement("div",{className:"message"},n.a.createElement("textarea",{value:this.state.text,onKeyDown:this.keyDown,onChange:this.handleTextChange}),n.a.createElement("div",{className:"send",onClick:this.sendMessage},"SEND")))}}]),t}(n.a.Component)),L=(a(138),function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).logout=function(){a.socket.emit("leave"),a.socket.disconnect(),fetch(S.sessionApi,{method:"delete"}).then(a.props.onLogout)},a.sendMessage=function(){a.socket.emit("send message",{message:a.state.message,username:a.props.user})},a.getUserList=function(){return a.state.allusers.filter(function(e){return e!==a.props.user.toLowerCase()})},a.getVideos=function(){var e=[],t=a.state,s=t.viewVideo,r=t.shareVideo,o=t.videoUsers;return r&&e.push(n.a.createElement(C,{socket:a.socket,user:"You"})),s&&o.filter(function(e){return e!==a.props.user}).forEach(function(t){return e.push(n.a.createElement("div",{className:"imageContainer"},n.a.createElement("img",{src:a.state.imageSrc[t]}),n.a.createElement("div",null,t)))}),e},a.state={message:"",allMessages:[],imageSrc:{},shareVideo:!1,viewVideo:!1,allusers:[],videoUsers:[]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.socket=O.a.connect("",{query:"username=".concat(this.props.user)}),this.socket.on("video",function(t){var a=t.image,s=t.user;e.setState({imageSrc:Object(h.a)({},e.state.imageSrc,Object(f.a)({},s,a))})}),this.socket.emit("join"),this.socket.on("user",function(t){e.setState({allusers:t})}),this.socket.on("video toggle",function(t){var a=t.videoUsers;e.setState({videoUsers:a})}),this.socket.on("send message",function(t){var a=t.message;e.setState({allMessages:e.state.allMessages.concat([a])})})}},{key:"componentWillUnmount",value:function(){this.socket.emit("leave"),this.socket.disconnect()}},{key:"render",value:function(){var e=this,t=this.getUserList(),a=this.state,s=a.viewVideo,r=a.shareVideo;return n.a.createElement("div",null,n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"title"},"Real-Time Chat Application"),n.a.createElement(w.a,{color:"inherit",onClick:this.logout},"Logout")),n.a.createElement("div",{className:"container"},n.a.createElement("div",{className:"top"},n.a.createElement("div",{className:"name"},"Welcome, ",this.props.user,"!"),n.a.createElement("div",{className:"actions"},n.a.createElement(N.a,{control:n.a.createElement(U.a,{checked:this.state.viewVideo,onChange:function(){return e.setState({viewVideo:!e.state.viewVideo})}}),label:"View Video"}),n.a.createElement(N.a,{control:n.a.createElement(U.a,{checked:this.state.shareVideo,onChange:function(){e.socket.emit("video toggle",!e.state.shareVideo),e.setState({shareVideo:!e.state.shareVideo})}}),label:"Share Video"}))),n.a.createElement("div",{className:"online"},!t.length&&"Nobody else online right now!",!!t.length&&"Other online users - ".concat(t.join(", "))),(s||r)&&n.a.createElement("div",{className:"videoWrapper"},this.getVideos()),n.a.createElement(x,{socket:this.socket,user:this.props.user})))}}]),t}(n.a.Component)),V=(a(139),a(140),function(e){function t(){var e,a;Object(i.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(n)))).state={username:"",isLoading:!1,users:[]},a.fetchUsers=function(){fetch(S.allUsersApi).then(function(e){return e.json()}).then(function(e){a.setState({users:e.map(function(e){return e.username.toLowerCase()})})})},a.onLogout=function(){a.setState({username:""})},a.onLogin=function(e){a.setState({username:e})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({isLoading:!0}),fetch(S.sessionApi).then(function(e){return e.json()}).then(function(t){t.user&&t.user.username?e.setState({username:t.user.username,isLoading:!1}):e.setState({username:"",isLoading:!1})}).catch(function(t){e.setState({isLoading:!1}),console.log(t)}),this.fetchUsers()}},{key:"render",value:function(){return this.state.isLoading?n.a.createElement("div",{className:"body"},n.a.createElement(m.a,null)):n.a.createElement("div",null,this.state.username?n.a.createElement(L,{onLogout:this.onLogout,user:this.state.username}):n.a.createElement(y,{onLogin:this.onLogin,users:this.state.users,fetchUsers:this.fetchUsers}))}}]),t}(s.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},23:function(e,t){e.exports={sessionApi:"/api/session",activeUsersApi:"/api/activeUsers",allUsersApi:"/api/users",headers:{Accept:"application/json","Content-Type":"application/json"}}},87:function(e,t,a){e.exports=a(141)},93:function(e,t,a){}},[[87,1,2]]]);
//# sourceMappingURL=main.bd3a49e0.chunk.js.map